@model Insightly_project.Models.TaskItem

@{
    ViewData["Title"] = "Details";
    bool isCompleted = Model.Status == Insightly_project.Models.TaskStatus.Completed;
}

<h2 class="mb-3"><i class="bi bi-card-checklist"></i> Task Details</h2>
<div class="card shadow-sm mb-3">
    <div class="card-body">
        <dl class="row mb-0">
            <dt class="col-sm-2">Title</dt>
            <dd class="col-sm-10">@Model.Title</dd>
            <dt class="col-sm-2">Status</dt>
            <dd class="col-sm-10">@Model.Status</dd>
            <dt class="col-sm-2">Due Date</dt>
            <dd class="col-sm-10">@(Model.DueDate?.ToString("yyyy-MM-dd") ?? "-")</dd>
            <dt class="col-sm-2">Project</dt>
            <dd class="col-sm-10">@Model.Project?.Name</dd>
            <dt class="col-sm-2">Assignees</dt>
            <dd class="col-sm-10">
                @{
                    var names = Model.TaskItemUsers?.Select(tu => tu.User?.UserName).Where(n => !string.IsNullOrEmpty(n)).ToList() ?? new List<string>();
                }
                @(names.Count == 0 ? "None" : string.Join(", ", names))
            </dd>
        </dl>
    </div>
</div>
<div class="d-flex justify-content-between">
    <div>
        <a asp-action="Index" class="btn btn-outline-secondary"><i class="bi bi-arrow-left"></i> Back</a>
        @if (User.IsInRole("Admin"))
        {
            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-outline-primary"><i class="bi bi-pencil"></i> Edit</a>
            <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-outline-danger"><i class="bi bi-trash"></i> Delete</a>
        }
        else if (User.IsInRole("TeamMember") && !isCompleted)
        {
            <form asp-action="SetStatus" method="post" class="d-inline">
                @Html.AntiForgeryToken()
                <input type="hidden" name="id" value="@Model.Id" />
                <input type="hidden" name="completed" value="true" />
                <input type="hidden" name="returnUrl" value="@Context.Request.Path@Context.Request.QueryString" />
                <button type="submit" class="btn btn-outline-success">
                    <i class="bi bi-check2-circle"></i> Mark Completed
                </button>
            </form>
        }
    </div>
</div>
